<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.8.1: http://docutils.sourceforge.net/" />
<title>Ruby on Rails Bootcamp</title>
<link rel="stylesheet" href="style/style.css" type="text/css" />
<link rel="stylesheet" href="style/highlight.css" type="text/css" />
<link rel="stylesheet" href="style/ptserif.css" type="text/css" />
</head>
<body>
<div class="document" id="ruby-on-rails-bootcamp">
<h1 class="title">Ruby on Rails Bootcamp</h1>

<p><a class="reference external" href="index.html">Back</a></p>
<div class="section" id="part-4-active-record">
<h1><a class="toc-backref" href="#id3">Part 4 - Active Record</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#part-4-active-record" id="id3">Part 4 - Active Record</a><ul>
<li><a class="reference internal" href="#demonstration" id="id4">Demonstration</a></li>
<li><a class="reference internal" href="#exercise-4-1" id="id5">Exercise 4.1</a></li>
<li><a class="reference internal" href="#demonstration-2" id="id6">Demonstration 2</a></li>
<li><a class="reference internal" href="#exercise-4-2" id="id7">Exercise 4.2</a></li>
<li><a class="reference internal" href="#extra-reading" id="id8">Extra Reading</a></li>
<li><a class="reference internal" href="#demonstration-3" id="id9">Demonstration 3</a></li>
<li><a class="reference internal" href="#exercise-4-3" id="id10">Exercise 4.3</a></li>
<li><a class="reference internal" href="#exercise-4-4" id="id11">Exercise 4.4</a></li>
<li><a class="reference internal" href="#screencasts" id="id12">Screencasts</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="demonstration">
<h2><a class="toc-backref" href="#id4">Demonstration</a></h2>
<ul>
<li><p class="first">Database generation script</p>
<ul class="simple">
<li>Connect to database</li>
<li>Create a migration</li>
<li>Run migrations</li>
</ul>
</li>
<li><p class="first">Connect to database</p>
<ul class="simple">
<li>create a model</li>
<li>add item</li>
<li>remove item</li>
</ul>
</li>
<li><p class="first">Basic validations</p>
</li>
<li><p class="first">Associations:</p>
<ul class="simple">
<li>has_one / belongs_to</li>
<li>has_many</li>
<li>has_many, :dependent =&gt; :destroy</li>
</ul>
</li>
<li><p class="first">Important notes:</p>
<ul>
<li><p class="first">If you want to modify/create a table and then modify/create objects
you must run <tt class="docutils literal"><span class="pre">{Model}.reset_column_information</span></tt>
(from <a class="reference external" href="http://stackoverflow.com/questions/8935350/rails-3-1-cant-write-to-column-in-same-migration-that-adds-it">stack overflow</a>).</p>
</li>
<li><p class="first">don't use attr_accessor for model attributes (it will override active record's default implementation).</p>
</li>
<li><p class="first">beware of <em>mass assignment</em>: (quote from comment by steve3210)</p>
<blockquote>
<p>This isn't actually a hole in rails..  If you use mass assignment, you need to protect attributes you don't want assigned with attr_protected on your model.</p>
<p>If you don't want people to do this:</p>
<div class="highlight"><pre><span class="vi">@user</span><span class="o">.</span><span class="n">update_attributes</span><span class="p">({</span> <span class="ss">:favorite_color</span> <span class="o">=&gt;</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span>
                          <span class="ss">:password</span> <span class="o">=&gt;</span> <span class="s1">&#39;hacked&#39;</span><span class="p">})</span>
</pre></div>
<p>You need to do this:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">attr_protected</span> <span class="ss">:password</span>
<span class="k">end</span>
</pre></div>
</blockquote>
</li>
</ul>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/elentok/ror-bootcamp/tree/gh-pages/exercises/active_record">ActiveRecord demonstration code</a>.</p>
</li>
</ul>
</div>
<div class="section" id="exercise-4-1">
<h2><a class="toc-backref" href="#id5">Exercise 4.1</a></h2>
<ul>
<li><p class="first">Create a file called ~/.pryrc and put these lines in the file:</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;logger&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;active_record&#39;</span>
<span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="no">Logger</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">STDOUT</span><span class="p">)</span>
</pre></div>
<p>This will show you the SQL code of every query.</p>
</li>
<li><p class="first">Read chapters 1-2 of <a class="reference external" href="http://guides.rubyonrails.org/association_basics.html">Association Basics</a></p>
</li>
<li><p class="first">Modify PizzaBurger to store the orders to an SQLite database using ActiveRecord.</p>
</li>
</ul>
</div>
<div class="section" id="demonstration-2">
<h2><a class="toc-backref" href="#id6">Demonstration 2</a></h2>
<ul class="simple">
<li>custom validations (using :validate)</li>
<li>callbacks (before_save, before_validation)</li>
<li>Setting a variable during the before_validation callback:
Use <tt class="docutils literal">self</tt> when accessing the attribute.
(see <a class="reference external" href="http://stackoverflow.com/questions/6065860/trying-to-set-a-variable-in-before-validation-but-it-isnt-working">trying to set a variable in before_validation but it isn't working</a>).</li>
</ul>
</div>
<div class="section" id="exercise-4-2">
<h2><a class="toc-backref" href="#id7">Exercise 4.2</a></h2>
<ul class="simple">
<li>Read chapters 1-4 of <a class="reference external" href="http://guides.rubyonrails.org/active_record_validations_callbacks.html">Validations</a></li>
<li>Add validations to the PizzaBurger models</li>
</ul>
</div>
<div class="section" id="extra-reading">
<h2><a class="toc-backref" href="#id8">Extra Reading</a></h2>
<ul class="simple">
<li>Read the rest of <a class="reference external" href="http://guides.rubyonrails.org/active_record_validations_callbacks.html">Validations</a></li>
</ul>
</div>
<div class="section" id="demonstration-3">
<h2><a class="toc-backref" href="#id9">Demonstration 3</a></h2>
<ul class="simple">
<li>Single Table Inheritance</li>
<li>Multi-Table (sort-of)Inheritance<ul>
<li>Using composition</li>
<li>Using polymorphic associations</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="exercise-4-3">
<h2><a class="toc-backref" href="#id10">Exercise 4.3</a></h2>
<ul class="simple">
<li>Read the rest of <a class="reference external" href="http://guides.rubyonrails.org/association_basics.html">Association Basics</a></li>
<li>Use single table inheritance to implement <tt class="docutils literal">PizzaOrder</tt> and <tt class="docutils literal">BurgerOrder</tt>.</li>
</ul>
</div>
<div class="section" id="exercise-4-4">
<h2><a class="toc-backref" href="#id11">Exercise 4.4</a></h2>
<ul class="simple">
<li>Now use polymorphic associations</li>
</ul>
</div>
<div class="section" id="screencasts">
<h2><a class="toc-backref" href="#id12">Screencasts</a></h2>
<ul class="simple">
<li>Watch <a class="reference external" href="https://www.destroyallsoftware.com/screencasts/catalog/what-goes-in-active-records">What goes in Active Records</a></li>
<li>Watch <a class="reference external" href="https://www.destroyallsoftware.com/screencasts/catalog/what-goes-in-active-records-part-2">What goes in Active Records Part 2</a></li>
</ul>
</div>
</div>
</div>
</body>
</html>
